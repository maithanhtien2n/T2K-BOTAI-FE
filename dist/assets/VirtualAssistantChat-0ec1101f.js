import{m as x,c as j,o as t,d as o,e,t as M,Y as y,Z as q,u as I,L as R,v as T,J as L,G as d,f as U,F as D,n as E,g as r,A as v,M as S,s as N,x as F,$ as G,w as H,q as A}from"./index-1b2f3aee.js";import{_ as K}from"./ButtonBack-403de9a1.js";const O={class:"flex gap-2"},z=["src"],J={class:"flex flex-column gap-1 w-full"},Y={class:"font-bold text-800"},Z=["innerHTML"],C={__name:"UserChat",props:{image:{type:String,required:!1,default:""},name:{type:String,required:!1,default:""},message:{type:String,required:!1,default:""},role:{type:String,required:!1,default:""}},setup(m){const p=m,i=x(()=>{switch(p.role){case"user":return{image:"/images/user.jpg",name:"Bạn"};case"assistant":return{image:"/images/botai.webp",name:"Trợ lý ảo"};default:return{image:"https://bloganchoi.com/wp-content/uploads/2022/02/avatar-trang-y-nghia.jpeg",name:""}}});return(l,w)=>{const g=j("Skeleton");return t(),o("div",O,[e("img",{class:"w-2rem h-2rem border-circle object-fit-cover box-shadow-1",src:i.value.image||"https://bloganchoi.com/wp-content/uploads/2022/02/avatar-trang-y-nghia.jpeg",alt:"Lỗi ảnh"},null,8,z),e("div",J,[e("span",Y,M(i.value.name),1),m.message?(t(),o("div",{key:0,innerHTML:m.message,style:{"text-align":"justify","white-space":"pre-wrap"},class:"text-800 line-height-3"},null,8,Z)):(t(),y(g,{key:1,class:"w-full mt-2",height:"4rem"}))])])}}},P={class:"flex flex-column h-full"},Q={key:1,class:"flex justify-content-center align-items-center"},W={class:"flex flex-column gap-3 align-items-center"},X=e("img",{class:"w-10rem h-10rem",src:"https://cdn-icons-png.flaticon.com/512/1698/1698535.png",alt:"Lỗi ảnh"},null,-1),ee={class:"text-center line-height-2"},te={class:"text-main-color"},se={key:0,class:"h-4rem"},ae={style:{bottom:"1.8rem","background-color":"#f2f1f7"},class:"fixed z-5 left-0 right-0 px-3"},ne={style:{"max-width":"50rem"},class:"p-3 border-round-3xl box-shadow-1 flex bg-white m-auto flex-1"},oe=["onKeypress"],le={style:{"padding-left":"0.7rem"},class:"border-left-1 text-400"},re={key:0,class:"pi pi-spin pi-spinner text-900"},ue={__name:"VirtualAssistantChat",setup(m){const p=q(),i=I(),{onGetterMessages:l,onActionChat:w,onActionCheckLinkChat:g,onActionCreateThread:B,onActionGetThread:V}=R(),c=T(""),u=T(!1),_=x(()=>p.query.thread),b=x(()=>p.params.userId),h=()=>{setTimeout(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})},1)},$=()=>{l.value=[],i.replace({name:"VirtualAssistant"})},k=async()=>{if(u.value)return;l.value.push({role:"user",content:c.value}),h();let s=c.value;c.value="",setTimeout(()=>{u.value=!0,h()},1e3);const a=await w({threadId:_.value,userId:b.value,content:s});a.success&&(l.value=a.data),h(),u.value=!1};return L(async()=>{var a,n;const s=await g(b.value);if(s.success)if(d.value.fullName=((a=s==null?void 0:s.data)==null?void 0:a.fullName)||"",d.value.userName=((n=s==null?void 0:s.data)==null?void 0:n.userName)||"",_.value)await V(_.value);else{const f=await B();f.success&&i.replace({name:"VirtualAssistantChat",params:{userId:d._id},query:{thread:f.data.id}})}else{i.replace({name:"NotFound"});return}h()}),(s,a)=>(t(),o("div",P,[U(K,{onOnBack:$}),e("div",{style:{"max-width":"52rem"},class:N([{"px-3 pb-3":!r(A),"justify-content-center":!r(l).length},"flex flex-1 flex-column gap-4 m-auto w-full pt-3"])},[(t(!0),o(D,null,E(r(l),(n,f)=>(t(),y(C,{key:f,image:"",name:n.role,message:n.content,role:n.role},null,8,["name","message","role"]))),128)),u.value?(t(),y(C,{key:0,role:"assistant"})):v("",!0),r(l).length?v("",!0):(t(),o("div",Q,[e("div",W,[X,e("span",ee,[S(" Chào bạn, tôi là chat bot do "),e("span",te,M(r(d).fullName||r(d).userName),1),S(" tạo ra! ")])])]))],2),r(A)?v("",!0):(t(),o("div",se)),e("div",ae,[e("div",ne,[F(e("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>c.value=n),type:"text",class:"w-full border-none outline-none",placeholder:"Bạn muốn hỏi gì?",onKeypress:H(k,["enter"])},null,40,oe),[[G,c.value]]),e("div",le,[u.value?(t(),o("i",re)):(t(),o("i",{key:1,class:N(["pi pi-angle-right text-900 on-click",{"p-disabled":!c.value}]),onClick:k},null,2))])])])]))}};export{ue as default};
